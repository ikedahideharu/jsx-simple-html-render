"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.JSXDependencyTree=void 0;var cli_progress_1=__importDefault(require("cli-progress")),dependency_tree_1=__importDefault(require("dependency-tree")),utility_1=require("./utility"),JSXDependencyTree=function(){function e(e){this.tree={},this.JSXDirectory=e,this.setTreeAll()}return e.prototype.setTree=function(e){var t;return e.match(/\.jsx$/)&&!this.tree[e]?(this.tree[e]=this.getDependencyTree(e),(t={})[e]=[],t):null},e.prototype.setTreeAll=function(){utility_1.log.y("> set JSX dependency tree");var e=utility_1.getJSXFilePaths(this.JSXDirectory,!1),t=new cli_progress_1.default.SingleBar({},cli_progress_1.default.Presets.shades_classic);t.start(e.length,1);for(var r=0;r<e.length;r++)this.tree[e[r]]=this.getDependencyTree(e[r]),t.update(r+1);t.stop()},e.prototype.getDependencyTree=function(e){return dependency_tree_1.default.toList({filename:e,directory:this.JSXDirectory,nodeModulesConfig:{entry:"module"},filter:function(e){return-1===e.indexOf("node_modules")},nonExistent:[]})},e.prototype.findDependencyFiles=function(t){var e,r;if(t.match(/\.jsx$/))return this.tree[t]?(this.clearRequireCache(t),(e={})[t]=[],e):(this.setTreeAll(),this.tree);var i,n={};for(i in this.tree)this.tree.hasOwnProperty(i)&&this.tree[i].some(function(e){return e===t})&&(this.clearRequireCache(i),n=__assign(__assign({},n),((r={})[i]=[],r)));return n},e.prototype.clearRequireCache=function(e){delete require.cache[e];for(var t=0;t<this.tree[e].length;t++)delete require.cache[this.tree[e][t]]},e.prototype.removeDependency=function(e){e.match(/\.jsx$/)&&delete this.tree[e]},e}();exports.JSXDependencyTree=JSXDependencyTree;